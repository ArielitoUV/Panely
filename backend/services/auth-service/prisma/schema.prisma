generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

model User {
  id            Int      @id @default(autoincrement())
  email         String   @unique
  password      String
  nombre        String
  apellido      String
  telefono      String?
  nombreEmpresa String?
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  // ← ESTA LÍNEA ES LA QUE FALTABA
  insumos       Insumo[]
  recetas       RecetaPan[]
  pedidos       Pedido[]

  refreshTokens RefreshToken[]
}

model RefreshToken {
  id        String   @id @default(cuid())
  userId    Int
  token     String   @unique
  expiresAt DateTime

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
}

model Insumo {
  id              Int      @id @default(autoincrement())
  nombre          String
  presentacion    String    // ej: "Bolsa 25kg"
  cantidadCompra  Float     // ej: 25 (para bolsa de 25kg)
  unidadMedida    String    // kg, lt, unidad
  valorCompra     Int       // precio total pagado
  costoPorUnidad  Float     // ← AUTOMÁTICO: valorCompra / cantidadCompra (por kg o lt)
  userId          Int
  createdAt       DateTime @default(now())

  user            User      @relation(fields: [userId], references: [id], onDelete: Cascade)
  recetaItems     RecetaItem[]

  @@index([userId])
}

model RecetaPan {
  id        Int           @id @default(autoincrement())
  nombre    String        // ej: "Pan Copihue", "Marraqueta"
  items     RecetaItem[]
  userId    Int
  user      User          @relation(fields: [userId], references: [id])

  pedidos   Pedido[]
}


model RecetaItem {
  id          Int       @id @default(autoincrement())
  recetaId    Int
  insumoId    Int
  cantidad    Float     // gramos o ml por 1 pan
  unidad      String    // siempre "g" o "ml"

  receta      RecetaPan @relation(fields: [recetaId], references: [id], onDelete: Cascade)
  insumo      Insumo   @relation(fields: [insumoId], references: [id])

  @@unique([recetaId, insumoId])
}

model Pedido {
  id            Int      @id @default(autoincrement())
  cliente       String
  cantidadPanes Int
  recetaId      Int
  costoTotal    Int
  fecha         DateTime @default(now())
  userId        Int

  user          User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  receta        RecetaPan @relation(fields: [recetaId], references: [id])

  @@index([userId])
  @@index([recetaId])
}